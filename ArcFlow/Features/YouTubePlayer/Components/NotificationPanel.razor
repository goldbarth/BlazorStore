@using ArcFlow.Features.YouTubePlayer.State
@inject IJSRuntime JS

<div class="notification-container">
    @foreach (var notification in Notifications)
    {
        <MudAlert Severity="@GetSeverity(notification.Severity)"
                  Variant="Variant.Filled"
                  Dense="true"
                  Class="notification-alert"
                  CloseIcon="@(notification.IsDismissible ? Icons.Material.Filled.Close : null)"
                  CloseIconClicked="@(() => OnDismiss.InvokeAsync(notification.CorrelationId))">
            @notification.Message
        </MudAlert>
    }
</div>

@code {
    [Parameter, EditorRequired]
    public IReadOnlyList<Notification> Notifications { get; set; } = [];

    [Parameter]
    public EventCallback<Guid> OnDismiss { get; set; }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        // Auto-dismiss after 5 seconds
        foreach (var notification in Notifications)
        {
            if (notification.IsDismissible)
            {
                await Task.Delay(5000).ContinueWith(_ =>
                    {
                    InvokeAsync(() => OnDismiss.InvokeAsync(notification.CorrelationId));
                    });
            }
        }
    }

    private Severity GetSeverity(NotificationSeverity severity) => severity switch
    {
        NotificationSeverity.Success => Severity.Success,
        NotificationSeverity.Info => Severity.Info,
        NotificationSeverity.Warning => Severity.Warning,
        NotificationSeverity.Error => Severity.Error,
        _ => Severity.Normal
    };
}