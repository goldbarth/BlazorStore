<MudDrawer Open="Open" OpenChanged="OnOpenChanged" Anchor="Anchor.Start"
           Variant="@DrawerVariant.Temporary" Width="320px" Elevation="4">
    <MudDrawerHeader>
        <MudText Typo="Typo.h6">Create Playlist</MudText>
    </MudDrawerHeader>
    <div class="pa-4">
        <MudTextField @bind-Value="_playlistName"
                      Label="Title"
                      Required="true"
                      RequiredError="Title is required"
                      Variant="Variant.Outlined"
                      Margin="Margin.Dense" />
        <MudTextField @bind-Value="_playlistDescription"
                      Label="Description (optional)"
                      Lines="3"
                      Variant="Variant.Outlined"
                      Margin="Margin.Dense"
                      Class="mt-3" />
        <div class="d-flex justify-end gap-2 mt-4">
            <MudButton OnClick="Cancel">Cancel</MudButton>
            <MudButton Color="Color.Dark"
                       OnClick="Submit"
                       Disabled="string.IsNullOrWhiteSpace(_playlistName)">
                Create
            </MudButton>
        </div>
    </div>
</MudDrawer>

@code {
    [Parameter] public bool Open { get; set; }
    [Parameter] public EventCallback<bool> OpenChanged { get; set; }
    [Parameter] public EventCallback<CreatePlaylistRequest> OnSubmit { get; set; }

    public sealed record CreatePlaylistRequest(string Name, string? Description);

    private string _playlistName = string.Empty;
    private string? _playlistDescription = string.Empty;

    private async Task OnOpenChanged(bool open)
    {
        if (!open) ResetForm();
        Open = open;
        await OpenChanged.InvokeAsync(open);
    }

    private async Task Submit()
    {
        if (string.IsNullOrWhiteSpace(_playlistName)) return;

        await OnSubmit.InvokeAsync(new CreatePlaylistRequest(_playlistName, _playlistDescription));
        await CloseDrawer();
    }

    private async Task Cancel() => await CloseDrawer();

    private async Task CloseDrawer()
    {
        ResetForm();
        Open = false;
        await OpenChanged.InvokeAsync(false);
    }

    private void ResetForm()
    {
        _playlistName = string.Empty;
        _playlistDescription = string.Empty;
    }
}
